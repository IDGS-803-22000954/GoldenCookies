<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flowbite Flask</title>
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='css/output.css')}}"
    />
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='css/style.css')}}"
    />
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Dancing+Script:wght@400..700&family=Kavoon&family=Parisienne&display=swap" rel="stylesheet">
    
  </head>

  <body>
    <header class="encabezado">
      <a href="../index.html">
      <img src="../static/img/logo_goldenCookies.jpeg" class="logo">
      </a>
    </header>
    {%with messages=get_flashed_messages()%}
    {%if messages%}
        {%for message in messages%}
            <div style="background-color:mediumaquamarine; color:white" class="bg-red-500 text-white p-4 rounded-lg">
                {{message}}
            </div>
        {%endfor%}
    {%endif%}
    {%endwith%}
    <div class="titulo">
      <img src="../static/img/carro-de-la-compra.png" alt="Venta" class="icono">
      <h1>Proveedores</h1>
    </div>

    
    <center>
      <button 
        onclick="toggleForm('agregar-form')" 
        style="background-color: #28a745; border-radius:13px; border-color:black; color:black;" 
        class="btn btn-warning px-4 py-2">
        Agregar Proveedor
      </button>
    </center>

    

    <!-- Contenedor para ambos formularios -->
    <div class="flex flex-col items-center gap-8">
      <!-- Formulario de agregar proveedores (oculto inicialmente) -->
      <div id="agregar-form" class="form-container hidden w-full max-w-md bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-6 text-center">Agregar Proveedor</h2>
        
        <form method="post" action="{{ url_for('proveedor_bp.agregarProveedor') }}" class="max-w-md mx-auto">
            {{ formulario.hidden_tag() }}
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">
                    {{ formulario.nombre.label }}
                </label>
                {{ formulario.nombre(style="background-color: white;", class="w-full p-2 border rounded") }}
                {% if formulario.nombre.errors %}
                    <div class="text-red-500 text-xs italic">
                        {% for error in formulario.nombre.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="mb-6">
                <label class="block text-sm font-bold mb-2">
                    {{ formulario.contacto.label }}
                </label>
                {{ formulario.contacto(style="background-color: white;", class="w-full p-2 border rounded") }}
                {% if formulario.contacto.errors %}
                    <div class="text-red-500 text-xs italic">
                        {% for error in formulario.contacto.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <div class="mb-6">
              <label class="block text-sm font-bold mb-2">
                  {{ formulario.telefono.label }}
              </label>
              {{ formulario.telefono(style="background-color: white;",class="w-full p-2 border rounded") }}
              {% if formulario.telefono.errors %}
                  <div class="text-red-500 text-xs italic">
                      {% for error in formulario.telefono.errors %}
                          {{ error }}
                      {% endfor %}
                  </div>
              {% endif %}
            </div>

            <div class="button-container flex justify-between">
              <button type="submit" style="background-color: #006BE5; border-radius:13px; border-color:black; color:black;" class="btn px-4 py-2">
                  Guardar Proveedor
              </button>
              <button type="button" onclick="toggleForm('agregar-form')" style="background-color: #DC3545; border-radius:13px; border-color:black; color:black;" class="btn px-4 py-2">
                  Cancelar
              </button>
            </div>
        </form>
      </div>

      <!-- Formulario de edición de proveedores (oculto inicialmente) -->
      <div id="editar-form" class="form-container hidden w-full max-w-md bg-white p-8 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-6 text-center">Editar Proveedor</h2>
        
        <form method="post" action="{{ url_for('proveedor_bp.editar_proveedor') }}" class="max-w-md mx-auto">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" id="edit_id_proveedor" name="id_proveedor">

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2" for="edit_nombre">
                    Nombre
                </label>
                <input type="text" style="background-color: white;" id="edit_nombre" name="nombre" class="w-full p-2 border rounded">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-bold mb-2" for="edit_contacto">
                    Contacto
                </label>
                <input type="text" style="background-color: white;" id="edit_contacto" name="contacto" class="w-full p-2 border rounded">
            </div>
            
            <div class="mb-6">
              <label class="block text-sm font-bold mb-2" for="edit_telefono">
                  Teléfono
              </label>
              <input type="text" style="background-color: white;" id="edit_telefono" name="telefono" class="w-full p-2 border rounded">
            </div>

            <div class="button-container flex justify-between">
              <button type="submit" style="background-color: #006BE5; border-radius:13px; border-color:black; color:black;" class="btn px-4 py-2">
                  Guardar Cambios
              </button>
              <button type="button" onclick="limpiarYocultarFormularioEditar()" style="background-color: #DC3545; border-radius:13px; border-color:black; color:black;" class="btn px-4 py-2">
                  Cancelar
              </button>
            </div>
        </form>
      </div>
    </div>

    <center>
    <div class="container mt-5">
      <h2 class="text-center mb-4">Lista de Proveedores</h2>
      <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Contacto</th>
                <th>Teléfono</th>
                <th>Estatus</th>
                <th>Fecha de Creación</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for proveedor in proveedores %}
            <tr>
                <td>{{ proveedor.id_proveedor }}</td>
                <td>{{ proveedor.nombre }}</td> 
                <td>{{ proveedor.contacto }}</td>
                <td>{{ proveedor.telefono }}</td>
                <td>{{ 'Activo' if proveedor.estatus else 'Inactivo' }}</td>
                <td>{{ proveedor.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>
                  <div class="flex justify-center items-center gap-2">
                    <!-- Botón de editar -->
                    <button onclick="cargarDatosEdicion('{{ proveedor.id_proveedor }}', '{{ proveedor.nombre }}', '{{ proveedor.contacto }}', '{{ proveedor.telefono }}')" 
                      class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-1 px-2 rounded">
                      <img src="../static/img/editar.png" alt="Editar" style="max-width: 50px; width: 100%; height: auto;">
                    </button>
                    <!-- Botón de activar/desactivar -->
                    <a href="{{ url_for('proveedor_bp.cambiar_estatus', id=proveedor.id_proveedor) }}" 
                      class="btn {{ 'btn-danger' if proveedor.estatus else 'btn-success' }} btn-sm"
                      style="background-color: #DC3545; border-radius:5px; border-color:black; color:black;">
                      {{ 'Desactivar' if proveedor.estatus else 'Activar' }}
                    </a>
                  </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
    </center>

    <script>
    function cargarDatosEdicion(id, nombre, contacto, telefono) {
        document.getElementById('edit_id_proveedor').value = id;
        document.getElementById('edit_nombre').value = nombre;
        document.getElementById('edit_contacto').value = contacto;
        document.getElementById('edit_telefono').value = telefono;
        
        // Mostrar el formulario de edición y ocultar el de agregar
        document.getElementById('agregar-form').classList.add('hidden');
        document.getElementById('editar-form').classList.remove('hidden');
        
        // Desplazarse al formulario
        document.getElementById('editar-form').scrollIntoView({
            behavior: 'smooth'
        });
    }
    
    function limpiarYocultarFormularioEditar() {
        document.getElementById('edit_id_proveedor').value = '';
        document.getElementById('edit_nombre').value = '';
        document.getElementById('edit_contacto').value = '';
        document.getElementById('edit_telefono').value = '';
        document.getElementById('editar-form').classList.add('hidden');
    }
    
    function toggleForm(formId) {
        const form = document.getElementById(formId);
        
        // Ocultar el otro formulario
        const otherFormId = formId === 'agregar-form' ? 'editar-form' : 'agregar-form';
        document.getElementById(otherFormId).classList.add('hidden');
        
        // Alternar la visibilidad del formulario solicitado
        form.classList.toggle('hidden');
        
        // Si se está mostrando, desplazarse a él
        if (!form.classList.contains('hidden')) {
            form.scrollIntoView({behavior: 'smooth'});
        }
        
        // Limpiar formulario de edición si se está mostrando el de agregar
        if (formId === 'agregar-form' && !form.classList.contains('hidden')) {
            limpiarYocultarFormularioEditar();
        }
    }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
  </body>
</html>